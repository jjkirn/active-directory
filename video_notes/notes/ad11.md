# [PASSWORDS LEFT OUT IN THE OPEN (Active Directory #10)](https://www.youtube.com/watch?v=EHL8xuRfUF8)

In this video, John "bounces" between two perspectives:
- Setting up the AD workspace (mods to gen_ad.ps1, ad_schema.json)
- Attacking using Kali tools (bloodhoud.py, bloodhound, direct view of files from bloodhound.py)

---
Start out on the Management computer, go to active_directory:
```
PS C:\Users\local_admin> cd .\active_directory\
```

Open up vs code:
```
PS C:\Users\local_admin\active_directory> code .
```
---
John discusses making changes to "ad_schema.json" file to support a "show_password" field.
He opens ["vulnad.ps1" file from the WazeHell github](https://github.com/WazeHell/vulnerable-AD/vulnad.ps1) for ideas on how to support his idea.

---
John adds a field (at line 16) to the "ad_schema.json" file as follows:
```
    'show_password": true,
```

He also makes a changes (starting at line 35) to the "gen_ad.ps1" file to support utilizing the new field:
```
    if ( $userObject.show_password){
        Set-ADUser $principalName -Description "Your default password is: $password"
    }
```
He then deceided to add another user (Dan) (beginning around line 37) with a long...... complicated password to "ad_schema.json":
```
    {
        "name": "Dan An",
        "password":"HakzNy723bas1jk&1023#hahepleasesubscribelol!",
        "show_password": true,
        "groups": [
            "Employees"
	    ]
    }
```
He also removed all the "local_admin" stuff from "ad_schema.json".

---
Now time to put the changes on the Domain controller (DC1).

Reminder, we currently on the Management computer, lets enter the Domain credentials:
```
PS C:\Users\local_admin\active_directory> $cred = (Get-Credential)
[popup for credentials apears]
XYZ\Adminstrator
P@ssw0rd123!
```

Create a new session to DC1:
```
PS C:\Users\local_admin\active_directory> Enter-PSSession $dc1
[192.168.175.155]: PS C:\Users\Adminstrator\Documents>
```

---
I added this as John did it out of order and got errors.

Move to Windows\Tasks directory:
```
[192.168.175.155]: PS C:\Users\Adminstrator\Documents> cd C:\Windows\Tasks
```
Remove any previous users:
```
[192.168.175.155]: PS C:\Windows\Tasks> .\gen_ad.ps1 .\ad_schema.json -Undo
```

---
Back to John's steps.

Temporaliy exit PS session:
```
[192.168.175.155]: PS C:\Windows\Tasks> exit
```
Go to code directory:
```
PS C:\Users\local_admin\active_directory> cd code
```

Transfer the modified "ad_schema" to DC1:
```
PS C:\Users\local_admin\active_directory>Copy-Item .\ad_schema.json -ToSession $dc1 -Destination C:\Windows\Tasks
```

Transfer the modified "gen_ad.ps1" to DC1:
```
PS C:\Users\local_admin\active_directory>Copy-Item .\gen_ad.ps1 -ToSession $dc1 -Destination C:\Windows\Tasks
```

Get back into session to DC1:
```
PS C:\Users\local_admin\active_directory> Enter-PSSession $dc1
[192.168.175.155]: PS C:\Users\Adminstrator\Documents>
```

Move to Windows\Tasks directory:
```
[192.168.175.155]: PS C:\Users\Adminstrator\Documents> cd C:\Windows\Tasks
```

Run the gen_ad.ps1 script:
```
[192.168.175.155]: PS C:\Windows\Tasks> .\gen_ad.ps1 .\ad_schema.json
```

All should run OK!

---
Now for the Kali attacking section.

On the Kali VM, open a terminal window:
```
cd /tmp
mkdir passwords
cd passwords
```

Make sure the "/etc/resolv.conf" file shows the Domain controller (DC) info as follows:
```
search xyz.com
nameserver 192.168.175.155
```

Run the Bloodhound collector (bloodhound.py)
```
bloodhoud-python -u alice -p bubbles -dc dc1.xyz.com --dicalbe-autogc -d xyz.com -c all
```
Should have several .json files created.

---
Time to run Bloodhund.

Start up neo4j in prep for running Bloodhoud:
```
sudo neo4j console
```
In a new terminal window, run Bloodhound:
```
./Bloodhound
```

Login using these creds:
```
neo4j:bloodhoud
```

Bloodhound should now be running.

At the bottom of the left panel, "Clear" out any previous data.

Select "upload data" on the right side.
```
cd to /tmp
select all .json files
open
```

Now all data should be in Bloodhound.

John selected "Domain Users"

clicked on it

get direct menbers

Find "DAN@XYZ"

When you click on it, the left panel under "Description" shows the password !!!

John notes that the defaut SharpHound.exe collector may not import the Description field.

exit Bloodhoud
```
back to /tmp
```

Can just seach the .json files directly for info like "password"

John hints that some Certification programs uses this.

---
END OF THIS VIDEO !


